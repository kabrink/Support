---
title: "Support"
author: "Kimberly A. Brink"
date: '`r format(Sys.Date(),"%B %d, %Y")`'
output: html_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r install_libraries}
library(lubridate) #for calculating ages
library(Hmisc) #for reading SPSS files
library(pander) #for displaying tables
```

```{r standard_error}
#calculates standard error
s.error <- function(x) sd(x)/sqrt(length(x))
```

```{r load_file}
filename="/Volumes/lsa-research01/ALL STUDIES/Current Studies/Support/Support 3.0/Support - Data v3.2.sav"
support <- spss.get(filename,datevars=c("DOB","DOT")) #recognize DOB and DOT files as date variables
```

```{r calculate_age}
support$Age = (year(as.period(interval(support$DOB, support$DOT)))*12) + month(as.period(interval(support$DOB, support$DOT))) + (day(as.period(interval(support$DOB, support$DOT)))/30)

#select only infants taht participated after 2016-01-13, the start of the final design of the study
support = support[which(support$DOT>='2016-01-13'),]
```

```{r calculate_crawl}
#converts variable strings to values for the crawl variable 
support$Crawl2 = ifelse(support$Crawl=="Very true", 3, ifelse(support$Crawl==levels(support$Crawl)[4], 2, ifelse(support$Crawl=="Rarely true", 1, ifelse(support$Crawl=="Not at all true", 0, NA))))
```

```{r calculate_dishab}
#calculate dishabituation: change in looking time from last familiarization trial to first test trial
#Positive values mean that the infant renewed interest and dishabituated
#Negative values mean that the infant looked for less time during test and did not dishabituate

support$dishab = ifelse(support$FirstTest == "No Contact",
                        support$NoContactTest1-support$LeftFam2,
                        support$ContactTest1-support$RightFam2)

#calculate how much infant habituation during familiarization: decrease in looking time for first familiarization trial to last familiarization trial
#support$hab = ifelse(support$FirstTest == "No Contact",
#                       support$RightFam1-support$LeftFam2,
#                       support$LeftFam1-support$RightFam2)

#calculate whether infants habituated (looking time on last trial decreased to less than half looking time of first trial)
#support$habYN = ifelse(support$FirstTest == "No Contact",
#                        ifelse(support$RightFam1>2*support$LeftFam2,1,0),
#                        ifelse(support$LeftFam1>2*support$RightFam2,1,0))

#calculate whether infants habituated (looking time on last two trials decreased to less than half looking time of first two trial)
#support$habYN = ifelse(mean(support$RightFam1+support$LeftFam1)>mean(support$LeftFam2+support$RightFam2),1,0)
```

###Demographics.
There were `r length(support$SubID)` participants.

```{r computer_error}
support$ContactTest.Average = (support$ContactTest1+support$ContactTest2+support$ContactTest3)/3
support$NoContactTest.Average = (support$NoContactTest1+support$NoContactTest2+support$NoContactTest3)/3

support = support[which(support$ContactTest.Average!='NA'),]
support = support[which(support$NoContactTest.Average!='NA'),]

support = support[which(support$Closed!="Closed"),]
```

Now there are `r length(support$SubID)` participants after removing for computer error. 

```{r crawling}
#support = support[which(support$Crawl2>0),]
```

Now there are `r length(support$SubID)` participants after removing for crawling. 

```{r demographics}
attach(support)
conCol= rgb(red=87/255,green=144/255,blue=154/255) #"darkblue"
nocCol= rgb(red=237/255,green=186/255,blue=20/255) #"red"
```

The average age of the sample is `r round(mean(Age), digits = 2)` months.

The median age of the sample is `r round(median(Age), digits = 2)` months.

The minimum age of the sample is `r round(min(Age), digits = 2)` months.

The maximum age of the sample is `r round(max(Age), digits = 2)` months.

There are `r sum(support$Sex == "Female")` females in the sample.

The first date of test was `r min(DOT)`.

The most recent date of test was `r max(DOT)`.

#Tests for normality
```{r boxplots}
boxplot(ContactTest1, ContactTest2, ContactTest3, NoContactTest1, NoContactTest2, ContactTest3, col = c(rep(conCol,3),rep(nocCol,3)))
```

```{r histograms, fig.width = 8, fig.height = 5}
hist(ContactTest1, col = conCol, breaks = 10)
hist(ContactTest2, col = conCol, breaks = 10)
hist(ContactTest3, col = conCol, breaks = 10)
hist(NoContactTest1, col = nocCol, breaks = 10)
hist(NoContactTest2, col = nocCol, breaks = 10)
hist(NoContactTest3, col = nocCol, breaks = 10)
```

#Bar Graph: Median by Test Trial
```{r barplot_median_trial, fig.path='Figures/', dev=c('png','postscript'), fig.width = 6, fig.height = 6}
medians <- matrix(c(median(ContactTest1),median(ContactTest2),median(ContactTest3),median(NoContactTest1),median(NoContactTest2),median(NoContactTest3)),ncol=3,byrow=TRUE)
colnames(medians) <- c("Test Trial 1","Test Trial 2","Test Trial 3")
rownames(medians) <- c("Contact","No Contact")
medians <- as.table(medians)

g.range = range(0,ceiling(max(medians))+5)

plot.new()
barCenters <- barplot(medians, col=c(conCol,nocCol), legend = rownames(medians), ylab = "Median Looking Time (sec)", beside = TRUE, ylim=g.range)
text(barCenters,medians+1.5,label=medians)
```

#Wilcox Test
Because the distribution of the Test trial is not normal we will use the non-parametric within samples t-test.
```{r wilcox_test}

t1 = wilcox.test(NoContactTest1,ContactTest1,paired=TRUE)
Z1 = round(qnorm(t1$p.value/2),digits = 2)
p1 = round(t1$p.value, digits = 2)
p1 <- ifelse(p1<0.001, 0.001, ifelse(p1<0.01, 0.01, ifelse(p1<0.05,0.05,p1)))

 t2 = wilcox.test(NoContactTest2,ContactTest2,paired=TRUE)
 Z2 = round(qnorm(t2$p.value/2),digits = 2)
 p2 = round(t2$p.value, digits = 2)
 p2 <- ifelse(p2<0.001, 0.001, ifelse(p2<0.01, 0.01, ifelse(p2<0.05,0.05,p2)))

 t3 = wilcox.test(NoContactTest3,ContactTest3,paired=TRUE)
 Z3 = round(qnorm(t3$p.value/2),digits = 2)
 p3 = round(t3$p.value, digits = 2)
 p3 <- ifelse(p3<0.001, 0.001, ifelse(p3<0.01, 0.01, ifelse(p3<0.05,0.05,p3)))
```

There was no difference in looking times between the first Contact test event (Median =
`r median(ContactTest1)`) and the first No Contact event (Median = 
`r median(NoContactTest1)`),  (Wilcoxon *Z* = `r Z1`,  *p* = `r p1`)

There was no difference in looking times between the second Contact test event (Median = `r median(ContactTest2)`) and the second No Contact event (Median = 
`r median(NoContactTest2)`),  (Wilcoxon *Z* = `r Z2`,  *p* = `r p2`).

There was no difference in looking times between the third Contact test event (Median =
`r median(ContactTest3)`) and the third No Contact event (Median = 
`r median(NoContactTest3)`),  (Wilcoxon *Z* = `r Z3`,  *p* = `r p3`).

#Bar Graph: Means by Test Trial
```{r barplot_means_trial, fig.path='Figures/', dev=c('png','postscript'), fig.width = 8, fig.height = 7}
means <- matrix(c(mean(ContactTest1),mean(ContactTest2),mean(ContactTest3),mean(NoContactTest1),mean(NoContactTest2),mean(NoContactTest3)),ncol=3,byrow=TRUE)
se <- matrix(c(s.error(ContactTest1),s.error(ContactTest2),s.error(ContactTest3),s.error(NoContactTest1),s.error(NoContactTest2),s.error(NoContactTest3)),ncol=3,byrow=TRUE)

colnames(means) <- c("Test Trial 1","Test Trial 2","Test Trial 3")
rownames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+10)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), legend = rownames(means), ylab = "Mean Looking Time (sec)", beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)
```

```{r ttest}
t1 = t.test(NoContactTest1,ContactTest1,paired=TRUE)

t2 = t.test(NoContactTest2,ContactTest2,paired=TRUE)

t3 = t.test(NoContactTest3,ContactTest3,paired=TRUE)
```

There was no difference in looking times between the first Possible test event (M =
`r round(mean(ContactTest1), 2)`) and the first Impossible event (M = 
`r round(mean(NoContactTest1),2)`),  (t(`r round(t1$parameter,2)`) = `r round(t1$statistic,2)`,  *p* = `r round(t1$p.value,2)`).

There was no difference in looking times between the second Possible test event (M = 
`r round(mean(ContactTest2),2)`) and the second Impossible event (M = 
`r round(mean(NoContactTest2),2)`),  (t(`r round(t2$parameter,2)`) = `r round(t2$statistic,2)`,  *p* = `r round(t2$p.value,2)`).

There was no difference in looking times between the third Possible test event (M =
`r round(mean(ContactTest3),2)`) and the third Impossible event (M = 
`r round(mean(NoContactTest3),2)`),  (t(`r round(t3$parameter,2)`) = `r round(t3$statistic,2)`,  *p* = `r round(t3$p.value,2)`).

#Bar Graph: Average Looking Time Across Condition

```{r barplot_means, fig.path='Figures/', dev=c('png','postscript'), fig.width = 4, fig.height = 7, include=TRUE}
means <- matrix(c(mean(ContactTest.Average), mean(NoContactTest.Average)),ncol=2,byrow=TRUE)
se <- matrix(c(s.error(ContactTest.Average),s.error(NoContactTest.Average)),ncol=2,byrow=TRUE)

colnames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+10)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), ylab = "Mean Looking Time (sec)", beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)

t.avg = t.test(NoContactTest.Average,ContactTest.Average,paired=TRUE)
```

There was no difference in looking times between the average looking time of all three Possible test events (M =
`r round(mean(ContactTest.Average),2)`) and the average looking time of all three Impossible events (M = 
`r round(mean(NoContactTest.Average),2)`),  (t(`r round(t.avg$parameter,2)`) = `r round(t.avg$statistic,2)`,  *p* = `r round(t.avg$p.value,2)`).

##Mean of first trial between subjects
```{r between_mean}
imp.first <- support[which(support$FirstTest == "No Contact"),]
poss.first <- support[which(support$FirstTest == "Contact"),]

pander(t.test(imp.first$NoContactTest1,poss.first$ContactTest1))
pander(wilcox.test(imp.first$NoContactTest1,poss.first$ContactTest1))

means <- matrix(c(mean(poss.first$ContactTest1), mean(imp.first$NoContactTest1)),ncol=2,byrow=TRUE)
se <- matrix(c(s.error(poss.first$ContactTest1),s.error(imp.first$NoContactTest1)),ncol=2,byrow=TRUE)

colnames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+10)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), ylab = "Mean Looking Time (sec)", beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)
```

##Median of first trial between subjects
```{r between_median}
medians <- matrix(c(median(poss.first$ContactTest1), median(imp.first$NoContactTest1)),ncol=2,byrow=TRUE)
se <- matrix(c(s.error(poss.first$ContactTest1),s.error(imp.first$NoContactTest1)),ncol=2,byrow=TRUE)

colnames(medians) <- c("Contact","No Contact")
medians <- as.table(medians)
mediansR <- round(medians,2)
g.range = range(floor(min(medians))-10,ceiling(max(medians))+10)

plot.new()
barCenters <- barplot(medians, col=c(conCol,nocCol), ylab = "Median Looking Time (sec)", beside = TRUE, ylim=g.range)
text(barCenters,medians+1.5,label=mediansR)
```

##Dishabituation (Difference between last familiarization and first test)
###Positive values indicate dishabituation (renewed interest), negative values indicate no dishabituation

##Mean of dishabituation
```{r dishab_mean}
pander(t.test(imp.first$dishab,poss.first$dishab))
pander(wilcox.test(imp.first$dishab,poss.first$dishab))

means <- matrix(c(mean(poss.first$dishab), mean(imp.first$dishab)),ncol=2,byrow=TRUE)
se <- matrix(c(s.error(poss.first$dishab),s.error(imp.first$dishab)),ncol=2,byrow=TRUE)

colnames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(floor(min(means))-10,ceiling(max(means))+10)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), ylab = "Mean Looking Time (sec)", beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)
```

##Median of Dishabituation
```{r dishab_median}
hist(poss.first$dishab, col = conCol, breaks = 10)
hist(imp.first$dishab, col = nocCol, breaks = 10)

medians <- matrix(c(median(poss.first$dishab), median(imp.first$dishab)),ncol=2,byrow=TRUE)

colnames(medians) <- c("Contact","No Contact")
medians <- as.table(medians)
mediansR <- round(medians,2)
g.range = range(floor(min(medians))-10,ceiling(max(medians))+10)

plot.new()
barCenters <- barplot(medians, col=c(conCol,nocCol), ylab = "Median Looking Time (sec)", beside = TRUE, ylim=g.range)
text(barCenters,medians+1.5,label=mediansR)
```


##Young (<=7.3 months) vs Old infants (>7.3) Average looking time across conditions
```{r young_vs_old_data}
youngsupport = support[which(support$Age<=7.3),]
oldsupport = support[which(support$Age>7.3),]

pander(table(support$Order,support$Age<=7.3))
pander(table(support$Sex,support$Age<=7.3))

pander(table(youngsupport$Sex,youngsupport$Order))
pander(table(oldsupport$Sex,oldsupport$Order))
```

There were `r length(youngsupport$ContactTest.Average)` less than or equal to 7.3 months old.
There were `r length(oldsupport$ContactTest.Average)` greater than or equal to 7.3 months old.

#Young vs Old Mean by Condition
```{r young_vs_old, fig.path='Figures/', dev=c('png','postscript'), fig.width = 6.5, fig.height = 6}
means <- matrix(c(mean(youngsupport$ContactTest.Average), mean(youngsupport$NoContactTest.Average), mean(oldsupport$ContactTest.Average), mean(oldsupport$NoContactTest.Average)),ncol=2,byrow=F)
se <- matrix(c(s.error(youngsupport$ContactTest.Average), s.error(youngsupport$NoContactTest.Average), s.error(oldsupport$ContactTest.Average), s.error(oldsupport$NoContactTest.Average)),ncol=2,byrow=F)

colnames(means) <- c("< 7.3 months","> 7.3 months")
rownames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+20)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), ylab = "Mean Looking Time (sec)", legend = rownames(means), beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)

pander(t.test(oldsupport$NoContactTest.Average,oldsupport$ContactTest.Average,paired=TRUE))
```

###Young by trial
```{r young_means,fig.path='Figures/', dev=c('png','postscript'), fig.width = 6, fig.height = 6}
means <- matrix(c(mean(youngsupport$ContactTest1),mean(youngsupport$ContactTest2),mean(youngsupport$ContactTest3),mean(youngsupport$NoContactTest1),mean(youngsupport$NoContactTest2),mean(youngsupport$NoContactTest3)),ncol=3,byrow=TRUE)
se <- matrix(c(s.error(youngsupport$ContactTest1),s.error(youngsupport$ContactTest2),s.error(youngsupport$ContactTest3),s.error(youngsupport$NoContactTest1),s.error(youngsupport$NoContactTest2),s.error(youngsupport$NoContactTest3)),ncol=3,byrow=TRUE)

colnames(means) <- c("Test Trial 1","Test Trial 2","Test Trial 3")
rownames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+12)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), legend = rownames(means), ylab = "Mean Looking Time (sec)", beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)

pander(t.test(youngsupport$NoContactTest1,youngsupport$ContactTest1,paired=TRUE))
```

##Old by trial
```{r old_means,fig.path='Figures/', dev=c('png','postscript'), fig.width = 6, fig.height = 6}
means <- matrix(c(mean(oldsupport$ContactTest1),mean(oldsupport$ContactTest2),mean(oldsupport$ContactTest3),mean(oldsupport$NoContactTest1),mean(oldsupport$NoContactTest2),mean(oldsupport$NoContactTest3)),ncol=3,byrow=TRUE)
se <- matrix(c(s.error(oldsupport$ContactTest1),s.error(oldsupport$ContactTest2),s.error(oldsupport$ContactTest3),s.error(oldsupport$NoContactTest1),s.error(oldsupport$NoContactTest2),s.error(oldsupport$NoContactTest3)),ncol=3,byrow=TRUE)

colnames(means) <- c("Test Trial 1","Test Trial 2","Test Trial 3")
rownames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+12)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), legend = rownames(means), ylab = "Mean Looking Time (sec)", beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)
```

##Young vs old first trial
```{r young_vs_old_t1,fig.path='Figures/', dev=c('png','postscript'), fig.width = 6.5, fig.height = 6}
youngsupport = support[which(support$Age<=7.3),]
oldsupport = support[which(support$Age>7.3),]

means <- matrix(c(mean(youngsupport$ContactTest1), mean(youngsupport$NoContactTest1), mean(oldsupport$ContactTest1), mean(oldsupport$NoContactTest1)),ncol=2,byrow=F)
se <- matrix(c(s.error(youngsupport$ContactTest1), s.error(youngsupport$NoContactTest1), s.error(oldsupport$ContactTest1), s.error(oldsupport$NoContactTest1)),ncol=2,byrow=F)

colnames(means) <- c("< 7.3 months","> 7.3 months")
rownames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+20)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), ylab = "Mean Looking Time (sec)", legend = rownames(means), beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)

pander(t.test(youngsupport$NoContactTest1,youngsupport$ContactTest1,paired=TRUE))
pander(t.test(oldsupport$NoContactTest1,oldsupport$ContactTest1,paired=TRUE))

pander(wilcox.test(youngsupport$NoContactTest1,youngsupport$ContactTest1,paired=TRUE))
pander(wilcox.test(oldsupport$NoContactTest1,oldsupport$ContactTest1,paired=TRUE))
```

##Young vs old third trial
```{r young_vs_old_t3,fig.path='Figures/', dev=c('png','postscript'), fig.width = 6.5, fig.height = 6, include=FALSE}

means <- matrix(c(mean(youngsupport$ContactTest3), mean(youngsupport$NoContactTest3), mean(oldsupport$ContactTest3), mean(oldsupport$NoContactTest3)),ncol=2,byrow=F)
se <- matrix(c(s.error(youngsupport$ContactTest3), s.error(youngsupport$NoContactTest3), s.error(oldsupport$ContactTest3), s.error(oldsupport$NoContactTest3)),ncol=2,byrow=F)

colnames(means) <- c("< 7.3 months","> 7.3 months")
rownames(means) <- c("Contact","No Contact")
means <- as.table(means)
meansR <- round(means,2)
g.range = range(0,ceiling(max(means))+20)

plot.new()
barCenters <- barplot(means, col=c(conCol,nocCol), ylab = "Mean Looking Time (sec)", legend = rownames(means), beside = TRUE, ylim=g.range)
arrows(barCenters, means-se, barCenters, means+se, lwd = 2, length=0.05, angle=90, code=3)
text(barCenters,means+se+1.5,label=meansR)

pander(t.test(youngsupport$NoContactTest3,youngsupport$ContactTest3,paired=TRUE))
pander(t.test(oldsupport$NoContactTest3,oldsupport$ContactTest3,paired=TRUE))

pander(wilcox.test(youngsupport$NoContactTest3,youngsupport$ContactTest3,paired=TRUE))
pander(wilcox.test(oldsupport$NoContactTest3,oldsupport$ContactTest3,paired=TRUE))
```
